<?php
namespace App\Http\Controllers\Admin; use App\Library\Helper; use App\Library\Response; use Illuminate\Http\Request; use App\Http\Controllers\Controller; class System extends Controller { private function set(Request $sp2f63b0, $sp06ba78) { foreach ($sp06ba78 as $spdbb9e7) { if ($sp2f63b0->has($spdbb9e7)) { \App\System::_set($spdbb9e7, $sp2f63b0->post($spdbb9e7)); } } } private function setMoney(Request $sp2f63b0, $sp06ba78) { foreach ($sp06ba78 as $spdbb9e7) { if ($sp2f63b0->has($spdbb9e7)) { \App\System::_set($spdbb9e7, intval($sp2f63b0->post($spdbb9e7) * 100)); } } } private function setInt(Request $sp2f63b0, $sp06ba78) { foreach ($sp06ba78 as $spdbb9e7) { if ($sp2f63b0->has($spdbb9e7)) { \App\System::_set($spdbb9e7, (int) $sp2f63b0->post($spdbb9e7)); } } } function setItem(Request $sp2f63b0) { $spdbb9e7 = $sp2f63b0->post('name'); $spd77a65 = $sp2f63b0->post('value'); if (!$spdbb9e7 || !$spd77a65) { return Response::forbidden(); } \App\System::_set($spdbb9e7, $spd77a65); return Response::success(); } function info(Request $sp2f63b0) { $sp38e391 = array('app_name', 'app_title', 'app_url', 'app_url_api', 'keywords', 'description', 'shop_ann', 'shop_ann_pop', 'shop_qq', 'js_tj', 'js_kf'); $sp0a6394 = array('shop_inventory'); if ($sp2f63b0->isMethod('GET')) { $sp42f333 = array(); foreach ($sp38e391 as $spdbb9e7) { $sp42f333[$spdbb9e7] = \App\System::_get($spdbb9e7); } foreach ($sp0a6394 as $spdbb9e7) { $sp42f333[$spdbb9e7] = (int) \App\System::_get($spdbb9e7); } return Response::success($sp42f333); } $spaf19c1 = array('app_url' => Helper::format_url($_POST['app_url']), 'app_url_api' => Helper::format_url($_POST['app_url_api'])); $sp2f63b0->merge($spaf19c1); $this->set($sp2f63b0, $sp38e391); $this->setInt($sp2f63b0, $sp0a6394); return Response::success(); } function theme(Request $sp2f63b0) { if ($sp2f63b0->isMethod('GET')) { \App\ShopTheme::freshList(); return Response::success(array('themes' => \App\ShopTheme::get(), 'default' => \App\ShopTheme::defaultTheme()->name)); } $sp5efa68 = $sp2f63b0->post('shop_theme'); if (!\App\ShopTheme::whereName($sp5efa68)->exists()) { return Response::fail(); } \App\System::_set('shop_theme_default', $sp5efa68); \App\ShopTheme::each(function (\App\ShopTheme $spa9e936) use($sp2f63b0) { if ($spa9e936->name === 'Material') { $spa9e936->config = array('list_type' => $sp2f63b0->post('shop_theme_material_list_type'), 'background' => $sp2f63b0->post('shop_theme_material_background')); $spa9e936->saveOrFail(); } if ($spa9e936->name === 'Classic') { $spa9e936->config = array('list_type' => $sp2f63b0->post('shop_theme_classic_list_type')); $spa9e936->saveOrFail(); } }); return Response::success(); } function order(Request $sp2f63b0) { $sp06ba78 = array('order_clean_unpay_open', 'order_clean_unpay_day'); if ($sp2f63b0->isMethod('GET')) { $sp42f333 = array(); foreach ($sp06ba78 as $spdbb9e7) { $sp42f333[$spdbb9e7] = (int) \App\System::_get($spdbb9e7); } return Response::success($sp42f333); } $this->setInt($sp2f63b0, $sp06ba78); return Response::success(); } function vcode(Request $sp2f63b0) { $sp38e391 = array('vcode_driver', 'vcode_geetest_id', 'vcode_geetest_key'); $sp0a6394 = array('vcode_login', 'vcode_shop_buy', 'vcode_shop_search'); if ($sp2f63b0->isMethod('GET')) { $sp42f333 = array(); foreach ($sp38e391 as $spdbb9e7) { $sp42f333[$spdbb9e7] = \App\System::_get($spdbb9e7); } foreach ($sp0a6394 as $spdbb9e7) { $sp42f333[$spdbb9e7] = (int) \App\System::_get($spdbb9e7); } return Response::success($sp42f333); } $this->set($sp2f63b0, $sp38e391); $this->setInt($sp2f63b0, $sp0a6394); return Response::success(); } function email(Request $sp2f63b0) { $sp38e391 = array('mail_driver', 'mail_smtp_host', 'mail_smtp_port', 'mail_smtp_username', 'mail_smtp_password', 'mail_smtp_from_address', 'mail_smtp_from_name', 'mail_smtp_encryption', 'sendcloud_user', 'sendcloud_key'); $sp0a6394 = array('mail_send_order'); if ($sp2f63b0->isMethod('GET')) { $sp42f333 = array(); foreach ($sp38e391 as $spdbb9e7) { $sp42f333[$spdbb9e7] = \App\System::_get($spdbb9e7); } foreach ($sp0a6394 as $spdbb9e7) { $sp42f333[$spdbb9e7] = (int) \App\System::_get($spdbb9e7); } return Response::success($sp42f333); } $this->set($sp2f63b0, $sp38e391); $this->setInt($sp2f63b0, $sp0a6394); return Response::success(); } function storage(Request $sp2f63b0) { $sp38e391 = array('storage_driver', 'storage_s3_access_key', 'storage_s3_secret_key', 'storage_s3_region', 'storage_s3_bucket', 'storage_oss_access_key', 'storage_oss_secret_key', 'storage_oss_bucket', 'storage_oss_endpoint', 'storage_oss_cdn_domain', 'storage_qiniu_domains_default', 'storage_qiniu_domains_https', 'storage_qiniu_access_key', 'storage_qiniu_secret_key', 'storage_qiniu_bucket', 'storage_qiniu_notify_url'); $sp0a6394 = array('storage_oss_is_ssl', 'storage_oss_is_cname'); if ($sp2f63b0->isMethod('GET')) { $sp42f333 = array(); foreach ($sp38e391 as $spdbb9e7) { $sp42f333[$spdbb9e7] = \App\System::_get($spdbb9e7); } foreach ($sp0a6394 as $spdbb9e7) { $sp42f333[$spdbb9e7] = (int) \App\System::_get($spdbb9e7); } return Response::success($sp42f333); } $this->set($sp2f63b0, $sp38e391); $this->set($sp2f63b0, $sp0a6394); return Response::success(); } function emailTest(Request $sp2f63b0) { $this->validate($sp2f63b0, array('to' => 'required')); $sp07c5e6 = $sp2f63b0->post('to'); try { $sp7210a9 = \Mail::to($sp07c5e6)->send(new \App\Mail\Test()); return Response::success($sp7210a9); } catch (\Exception $spa9e936) { \App\Library\LogHelper::setLogFile('mail'); \Log::error('Mail Test Exception:' . $spa9e936->getMessage()); return Response::fail($spa9e936->getMessage(), $spa9e936); } } function orderClean(Request $sp2f63b0) { $this->validate($sp2f63b0, array('day' => 'required|integer|min:1')); $spbaca1e = (int) $sp2f63b0->post('day'); \App\Order::where('status', \App\Order::STATUS_UNPAY)->where('created_at', '<', (new \Carbon\Carbon())->addDays(-$spbaca1e))->delete(); return Response::success(); } }