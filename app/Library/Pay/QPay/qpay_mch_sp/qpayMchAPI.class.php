<?php
require_once 'qpayMchUtil.class.php'; class QpayMchAPI { protected $url; protected $isSSL; protected $timeout; public function __construct($spaf19c1, $sp2601cb, $spbc7565 = 5) { $this->url = $spaf19c1; $this->isSSL = $sp2601cb; $this->timeout = $spbc7565; } public function notify_params() { $sp3e8e0b = file_get_contents('php://input'); return QpayMchUtil::xmlToArray($sp3e8e0b); } public function notify_verify($sp5e6808, $sp42f333) { if (!isset($sp5e6808['sign'])) { return false; } $sp7b1c1e = QpayMchUtil::getSign($sp5e6808, $sp42f333['mch_key']); return $sp7b1c1e === $sp5e6808['sign']; } public function req($sp5e6808, $sp42f333) { $sp7210a9 = array(); $sp5e6808['mch_id'] = $sp42f333['mch_id']; $sp5e6808['nonce_str'] = QpayMchUtil::createNoncestr(); $sp5e6808['sign'] = QpayMchUtil::getSign($sp5e6808, $sp42f333['mch_key']); $sp3e8e0b = QpayMchUtil::arrayToXml($sp5e6808); if (isset($this->isSSL)) { $sp7210a9 = QpayMchUtil::reqByCurlSSLPost($sp3e8e0b, $this->url, $this->timeout); } else { $sp7210a9 = QpayMchUtil::reqByCurlNormalPost($sp3e8e0b, $this->url, $this->timeout); } return $sp7210a9; } }