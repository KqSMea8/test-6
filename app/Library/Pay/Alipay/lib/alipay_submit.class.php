<?php
require_once 'alipay_core.function.php'; require_once 'alipay_md5.function.php'; class AlipaySubmit { var $alipay_config; var $alipay_gateway_new = 'https://mapi.alipay.com/gateway.do?'; function __construct($spcef7af) { $this->alipay_config = $spcef7af; } function AlipaySubmit($spcef7af) { $this->__construct($spcef7af); } function buildRequestMysign($sp2f1dd7) { $sp7bd489 = createLinkString($sp2f1dd7); switch (strtoupper(trim($this->alipay_config['sign_type']))) { case 'MD5': $sp2ae15c = md5Sign($sp7bd489, $this->alipay_config['key']); break; default: $sp2ae15c = ''; } return $sp2ae15c; } function buildRequestPara($spb3c003) { $spcd1f53 = paraFilter($spb3c003); $sp2f1dd7 = argSort($spcd1f53); $sp2ae15c = $this->buildRequestMysign($sp2f1dd7); $sp2f1dd7['sign'] = $sp2ae15c; $sp2f1dd7['sign_type'] = strtoupper(trim($this->alipay_config['sign_type'])); return $sp2f1dd7; } function buildRequestParaToString($spb3c003) { $spe14932 = $this->buildRequestPara($spb3c003); $spbdb407 = createLinkStringUrlEncode($spe14932); return $spbdb407; } function buildRequestForm($spb3c003, $spd92fdb, $spdda185) { $spe14932 = $this->buildRequestPara($spb3c003); $sp747f8a = '<form id=\'alipaysubmit\' name=\'alipaysubmit\' action=\'' . $this->alipay_gateway_new . '_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])) . '\' method=\'' . $spd92fdb . '\'>'; foreach ($spe14932 as $spb5c5a0 => $spe3999d) { $sp747f8a .= '<input type=\'hidden\' name=\'' . $spb5c5a0 . '\' value=\'' . $spe3999d . '\'/>'; } $sp747f8a = $sp747f8a . '<input type=\'submit\'  value=\'' . $spdda185 . '\' style=\'display:none;\'></form>'; $sp747f8a = $sp747f8a . '<script>document.forms[\'alipaysubmit\'].submit();</script>'; return $sp747f8a; } function query_timestamp() { $spaf19c1 = $this->alipay_gateway_new . 'service=query_timestamp&partner=' . trim(strtolower($this->alipay_config['partner'])) . '&_input_charset=' . trim(strtolower($this->alipay_config['input_charset'])); $sp31171a = ''; $sp0b9bc5 = new DOMDocument(); $sp0b9bc5->load($spaf19c1); $sp1e5f29 = $sp0b9bc5->getElementsByTagName('encrypt_key'); $sp31171a = $sp1e5f29->item(0)->nodeValue; return $sp31171a; } }