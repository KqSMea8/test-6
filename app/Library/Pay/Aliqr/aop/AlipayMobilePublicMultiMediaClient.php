<?php
include 'AlipayMobilePublicMultiMediaExecute.php'; class AlipayMobilePublicMultiMediaClient { private $DEFAULT_CHARSET = 'UTF-8'; private $METHOD_POST = 'POST'; private $METHOD_GET = 'GET'; private $SIGN = 'sign'; private $timeout = 10; private $serverUrl; private $appId; private $privateKey; private $prodCode; private $format = 'json'; private $sign_type = 'RSA'; private $charset; private $apiVersion = '1.0'; private $apiMethodName = 'alipay.mobile.public.multimedia.download'; private $media_id = 'L21pZnMvVDFQV3hYWGJKWFhYYUNucHJYP3Q9YW13ZiZ4c2lnPTU0MzRhYjg1ZTZjNWJmZTMxZGJiNjIzNDdjMzFkNzkw575'; private $connectTimeout = 3000; private $readTimeout = 15000; function __construct($sp441048 = '', $sp0d1df1 = '', $sp8016d8 = '', $spd977f3 = '', $sp293204 = 'GBK') { $this->serverUrl = $sp441048; $this->appId = $sp0d1df1; $this->privateKey = $sp8016d8; $this->format = $spd977f3; $this->charset = $sp293204; } public function getContents() { $spead9d6 = array('app_id' => $this->appId, 'method' => $this->METHOD_POST, 'sign_type' => $this->sign_type, 'version' => $this->apiVersion, 'timestamp' => date('Y-m-d H:i:s'), 'biz_content' => '{"mediaId":"' . $this->media_id . '"}', 'charset' => $this->charset); $spe6e21f = $this->buildGetUrl($spead9d6); $sp52b1f8 = $spe6e21f; $sp03f466 = curl_init(); curl_setopt($sp03f466, CURLOPT_URL, $this->serverUrl); curl_setopt($sp03f466, CURLOPT_HEADER, TRUE); curl_setopt($sp03f466, CURLOPT_RETURNTRANSFER, 1); curl_setopt($sp03f466, CURLOPT_TIMEOUT, $this->timeout); if ($this->METHOD_POST == 'POST') { curl_setopt($sp03f466, CURLOPT_POST, 1); curl_setopt($sp03f466, CURLOPT_POSTFIELDS, $sp52b1f8); } $sp843855 = curl_exec($sp03f466); $sp666afe = curl_getinfo($sp03f466, CURLINFO_HTTP_CODE); curl_close($sp03f466); echo $sp843855; $spead9d6 = explode('

', $sp843855, 2); $sp3ec8c0 = $spead9d6[0]; if ($sp666afe == '200') { $spa1a573 = $spead9d6[1]; } else { $spa1a573 = ''; } return $this->execute($sp3ec8c0, $spa1a573, $sp666afe); } public function execute($sp3ec8c0 = '', $spa1a573 = '', $sp666afe = '') { $sp22af26 = new AlipayMobilePublicMultiMediaExecute($sp3ec8c0, $spa1a573, $sp666afe); return $sp22af26; } public function buildGetUrl($spd92986 = array()) { if (!is_array($spd92986)) { } $sp631d11 = $this->buildQuery($spd92986); $spb7cc52 = ''; $sp9efbac = 64; $spfb5eff = $this->privateKey; $spa1f58b = array(); if (!stripos($spfb5eff, '
')) { $sp3deb2c = 0; while ($spfb2658 = substr($spfb5eff, $sp3deb2c * $sp9efbac, $sp9efbac)) { $spa1f58b[] = $spfb2658; $sp3deb2c++; } } else { } $spfb5eff = '-----BEGIN RSA PRIVATE KEY-----
' . implode('
', $spa1f58b); $spfb5eff = $spfb5eff . '
-----END RSA PRIVATE KEY-----'; $spb619e2 = openssl_pkey_get_private($spfb5eff, $spb7cc52); $sp8d0c83 = ''; if ('RSA2' == $this->sign_type) { openssl_sign($sp631d11, $sp8d0c83, $spb619e2, OPENSSL_ALGO_SHA256); } else { openssl_sign($sp631d11, $sp8d0c83, $spb619e2, OPENSSL_ALGO_SHA1); } openssl_free_key($spb619e2); $sp8d0c83 = base64_encode($sp8d0c83); $sp8d0c83 = urlencode($sp8d0c83); $spb77232 = $sp631d11 . '&' . $this->SIGN . '=' . $sp8d0c83; return $spb77232; } public function buildQuery($spd92986) { if (!$spd92986) { return null; } ksort($spd92986); $sp5e6808 = array(); foreach ($spd92986 as $spb5c5a0 => $spd77a65) { $sp5e6808[] = $spb5c5a0 . '=' . $spd77a65; } $sp631d11 = implode('&', $sp5e6808); return $sp631d11; } }