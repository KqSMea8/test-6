<?php
interface ILogHandler { public function write($sp32b59e); } class CLogFileHandler implements ILogHandler { private $handle = null; public function __construct($sp52e5cb = '') { $this->handle = @fopen($sp52e5cb, 'a'); } public function write($sp32b59e) { @fwrite($this->handle, $sp32b59e, 4096); } public function __destruct() { @fclose($this->handle); } } class WxLog { private $handler = null; private $level = 15; private static $instance = null; private function __construct() { } private function __clone() { } public static function Init($sp9bcdd5 = null, $spd3dda9 = 15) { if (!self::$instance instanceof self) { self::$instance = new self(); self::$instance->__setHandle($sp9bcdd5); self::$instance->__setLevel($spd3dda9); } return self::$instance; } private function __setHandle($sp9bcdd5) { $this->handler = $sp9bcdd5; } private function __setLevel($spd3dda9) { $this->level = $spd3dda9; } public static function DEBUG($sp32b59e) { } public static function WARN($sp32b59e) { self::$instance->write(4, $sp32b59e); } public static function ERROR($sp32b59e) { $sp4a5eb5 = debug_backtrace(); $spd17b41 = '['; foreach ($sp4a5eb5 as $spb5c5a0 => $spe3999d) { if (array_key_exists('file', $spe3999d)) { $spd17b41 .= ',file:' . $spe3999d['file']; } if (array_key_exists('line', $spe3999d)) { $spd17b41 .= ',line:' . $spe3999d['line']; } if (array_key_exists('function', $spe3999d)) { $spd17b41 .= ',function:' . $spe3999d['function']; } } $spd17b41 .= ']'; self::$instance->write(8, $spd17b41 . $sp32b59e); } public static function INFO($sp32b59e) { self::$instance->write(2, $sp32b59e); } private function getLevelStr($spd3dda9) { switch ($spd3dda9) { case 1: return 'debug'; break; case 2: return 'info'; break; case 4: return 'warn'; break; case 8: return 'error'; break; default: } } protected function write($spd3dda9, $sp32b59e) { if (($spd3dda9 & $this->level) == $spd3dda9) { $sp32b59e = '[' . date('Y-m-d H:i:s') . '][' . $this->getLevelStr($spd3dda9) . '] ' . $sp32b59e . '
'; $this->handler->write($sp32b59e); } } } $sp08ba31 = new CLogFileHandler('logs/' . date('Y-m-d') . '.log'); WxLog::Init($sp08ba31, 15);