<?php
class yekeAPI { function __construct() { } public static function getPayGate() { $sp5e6808 = array('action' => 'getPayType', 'userid' => yeke_USER_ID, 'sign' => md5(yeke_USER_ID . yeke_USER_KEY)); $sp594fbb = HttpClient::quickPost(yeke_API_GATE, $sp5e6808); return $sp594fbb; } public static function getPayType() { $sp176180 = json_decode(self::getPayGate(), true); $sp631d11 = array(); if ($sp176180['status']) { foreach ($sp176180['list'] as $spb5c5a0 => $spe3999d) { $sp631d11[] = array('paytype' => $spe3999d['paytype'], 'channelname' => $spe3999d['channelname']); } } return $sp631d11; } public static function getChannel($sp02c363) { $sp176180 = json_decode(self::getPayGate(), true); $sp631d11 = array(); if ($sp02c363 == 'card') { if ($sp176180['status'] && $sp176180['list']) { foreach ($sp176180['list'] as $spe3999d) { if ($spe3999d['paytype'] == $sp02c363) { foreach ($spe3999d['datalist'] as $spb5c5a0 => $sp5daa1b) { $sp631d11[] = array('channelid' => $sp5daa1b['channelid'], 'channelname' => $sp5daa1b['channelname'], 'imgurl' => $sp5daa1b['imgurl']); } } } } } else { if ($sp176180['status'] && $sp176180['list']) { foreach ($sp176180['list'] as $spe3999d) { if ($spe3999d['paytype'] == $sp02c363) { foreach ($spe3999d['datalist'] as $spb5c5a0 => $sp5daa1b) { $sp631d11[] = array('bankcode' => $sp5daa1b['bankcode'], 'bankname' => $sp5daa1b['bankname'], 'imgurl' => $sp5daa1b['imgurl']); } } } } } return $sp631d11; } public static function getCardValue() { $sp176180 = json_decode(self::getPayGate(), true); $sp631d11 = array(); if ($sp176180['status'] && $sp176180['list']) { foreach ($sp176180['list'] as $spe3999d) { if ($spe3999d['paytype'] == 'card') { foreach ($spe3999d['datalist'] as $spb5c5a0 => $spe3999d) { $sp631d11[] = array('channelid' => $spe3999d['channelid'], 'channelname' => $spe3999d['channelname'], 'cardvalue' => $spe3999d['cardvalue'], 'cardlength' => $spe3999d['cardlength']); } } } } return $sp631d11; } public static function getOrderID() { return date('Y') . date('m') . date('d') . date('H') . date('i') . date('s') . rand(100000, 999999); } public function payGate($sp5e6808) { $sp5e6808 = array_merge(array('P_userid' => yeke_USER_ID), $sp5e6808); $sp7b1c1e = $this->makeSign($sp5e6808); $sp5e6808 = array_merge($sp5e6808, array('P_sign' => $sp7b1c1e, 'action' => 'payGate')); switch ($sp5e6808['P_paytype']) { case 'bank': case 'alipay': case 'tenpay': case 'weixin': case 'wxwap': case 'sqzf': return $this->payGateBank($sp5e6808); break; case 'card': return $this->payGateCard($sp5e6808); break; default: return 'error,支付方式错误'; } } public function payGateBank($sp5e6808) { $spf2d586 = '<html><head><meta http-equiv="content-type" content="text/html;charset=utf-8"><title>请稍候，正在跳转...</title></head>'; $spf2d586 .= '<body onload="document.pay.submit()">'; $spf2d586 .= '请稍候，正在跳转...'; $spf2d586 .= '<form name="pay" action=' . yeke_API_GATE . ' method="post">'; foreach ($sp5e6808 as $spb5c5a0 => $spe3999d) { $spf2d586 .= '<input type="hidden" name="' . $spb5c5a0 . '" value="' . $spe3999d . '">'; } $spf2d586 .= '</body></html>'; return $spf2d586; } public function payGateCard($sp5e6808) { if ($sp5e6808['P_cardnum'] == '' || $sp5e6808['P_cardpwd'] == '' || $sp5e6808['P_cardvalue'] == '') { return 'error,卡信息不完整'; } $sp594fbb = HttpClient::quickPost(yeke_API_GATE, $sp5e6808); return $sp594fbb; } public function makeSign($sp5e6808) { $spf2d586 = ''; foreach ($sp5e6808 as $spb5c5a0 => $spe3999d) { $spf2d586 .= $spf2d586 ? '&' : ''; $spf2d586 .= $spb5c5a0 . '=' . $spe3999d; } $sp7b1c1e = md5($spf2d586 . yeke_USER_KEY); return $sp7b1c1e; } public function verifyNotify() { if (empty($_POST)) { return false; } $_POST['P_productname'] = urlencode($_POST['P_productname']); $_POST['P_productinfo'] = urlencode($_POST['P_productinfo']); $_POST['P_remark'] = urlencode($_POST['P_remark']); $_POST['P_custom_1'] = urlencode($_POST['P_custom_1']); $_POST['P_custom_2'] = urlencode($_POST['P_custom_2']); $_POST['P_contact'] = urlencode($_POST['P_contact']); $sp577523 = $_POST['P_sign']; foreach ($_POST as $spb5c5a0 => $spe3999d) { if ($spb5c5a0 == 'P_sign') { unset($_POST['P_sign']); } } $sp099a32 = $this->makeSign($_POST); $this->logs($_POST['P_api_orderid'], $_POST, $sp577523 . '=' . $sp099a32); if ($sp577523 == $sp099a32) { return true; } else { return false; } } public function verifyReturn() { if (empty($_GET)) { return false; } $_GET['P_productname'] = urlencode($_GET['P_productname']); $_GET['P_productinfo'] = urlencode($_GET['P_productinfo']); $_GET['P_remark'] = urlencode($_GET['P_remark']); $_GET['P_custom_1'] = urlencode($_GET['P_custom_1']); $_GET['P_custom_2'] = urlencode($_GET['P_custom_2']); $_GET['P_contact'] = urlencode($_GET['P_contact']); $sp577523 = $_GET['P_sign']; foreach ($_GET as $spb5c5a0 => $spe3999d) { if ($spb5c5a0 == 'P_sign') { unset($_GET['P_sign']); } } $sp099a32 = $this->makeSign($_GET); if ($sp577523 == $sp099a32) { return true; } else { return false; } } public function logs($sp6b2f14, $sp5e6808, $sp099a32) { date_default_timezone_set('PRC'); if (!empty($sp5e6808)) { $spf2d586 = ''; foreach ($sp5e6808 as $spb5c5a0 => $spe3999d) { $spf2d586 .= $spf2d586 ? '&' : ''; $spf2d586 .= $spb5c5a0 . '=' . $spe3999d; } $sp154c4a = date('Y-m-d H:i:s') . '
' . $sp6b2f14 . '
' . $spf2d586 . '
' . $sp099a32 . '

........................................

'; $sp11da9a = 'log'; if (!file_exists($sp11da9a)) { mkdir($sp11da9a, 511, true); } $sp52f712 = yeke_USER_LOG_PREFIX . '-' . date('Y-m-d') . '.txt'; $sp297a75 = fopen($sp11da9a . '/' . $sp52f712, 'ab'); fwrite($sp297a75, $sp154c4a); fclose($sp297a75); } } }