<?php
namespace App\Library\Pay\Yeke; use App\Library\Pay\ApiInterface; class Api implements ApiInterface { private $url_notify = ''; private $url_return = ''; public function __construct($spae6a5b) { $this->url_notify = SYS_URL_API . '/pay/notify/' . $spae6a5b; $this->url_return = SYS_URL . '/pay/return/' . $spae6a5b; } function goPay($sp42f333, $sp79d97c, $spf49dcd, $spa1a573, $sp39c1e2) { $spda7912 = sprintf('%.2f', $sp39c1e2 / 100); define('yeke_USER_ID', $sp42f333['id']); define('yeke_USER_KEY', $sp42f333['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); $sp5daeb8 = strtolower($sp42f333['payway']); $sp70ba77 = ''; $spaa7a59 = ''; if ($sp5daeb8 == 'alipay' || $sp5daeb8 == 'alipay_wap') { $sp70ba77 = 'alipay'; $spaa7a59 = 'ALIPAY'; } elseif ($sp5daeb8 == 'tenpay' || $sp5daeb8 == 'tenpay_wap') { $sp70ba77 = 'tenpay'; $spaa7a59 = 'TENPAY'; } elseif ($sp5daeb8 == 'weixin') { $sp70ba77 = 'weixin'; $spaa7a59 = 'WEIXIN'; } elseif ($sp5daeb8 == 'weixin_wap') { $sp70ba77 = 'wxwap'; $spaa7a59 = 'wxwap'; } elseif ($sp5daeb8 == 'qq' || $sp5daeb8 == 'qq_wap') { $sp70ba77 = 'sqzf'; $spaa7a59 = 'sqzf'; } elseif ($sp5daeb8 == 'qq_wap') { $sp70ba77 = 'sqzfqb'; $spaa7a59 = 'sqzfqb'; } require 'yekeApiLib.php'; require 'HttpClient.php'; $spf49dcd = mb_substr($spf49dcd, 0, 50, 'UTF-8'); $spa1a573 = mb_substr($spa1a573, 0, 100, 'UTF-8'); $sp5e6808 = array('P_orderid' => $sp79d97c, 'P_paymoney' => $spda7912, 'P_productname' => urlencode($spf49dcd), 'P_productinfo' => urlencode($spa1a573), 'P_remark' => urlencode($sp79d97c), 'P_custom_1' => urlencode($spaa7a59), 'P_custom_2' => '', 'P_contact' => urlencode(SYS_NAME), 'P_paytype' => $sp70ba77, 'P_gateway' => $spaa7a59, 'P_cardnum' => '', 'P_cardpwd' => '', 'P_cardvalue' => '', 'P_notify_url' => $this->url_notify, 'P_return_url' => $this->url_return . '/' . $sp79d97c); $sp9b11a5 = new \yekeAPI(); $sp594fbb = $sp9b11a5->payGate($sp5e6808); echo $sp594fbb; } function verify($sp42f333, $sp7b72fc) { $spf1c6fe = isset($sp42f333['isNotify']) && $sp42f333['isNotify']; define('yeke_USER_ID', $sp42f333['id']); define('yeke_USER_KEY', $sp42f333['key']); define('yeke_USER_LOG_PREFIX', 'log'); define('yeke_API_GATE', 'http://www.yekepay.com/api/ApiGo.php'); require 'HttpClient.php'; require 'yekeApiLib.php'; $sp9b11a5 = new \yekeAPI(); if ($spf1c6fe) { $sp594fbb = $sp9b11a5->verifyNotify(); } else { $sp594fbb = $sp9b11a5->verifyReturn(); } if ($sp594fbb) { $spa5a570 = $_REQUEST['P_orderid']; $sp85e7e5 = $_REQUEST['P_api_orderid']; $spe00a7d = $_REQUEST['P_money']; if ($_REQUEST['P_status'] == 'SUCCESS') { $sp7b72fc($sp85e7e5, (int) ($spe00a7d * 100), $spa5a570); if ($spf1c6fe) { echo 'success'; } return true; } else { if ($spf1c6fe) { echo '失败订单'; } } } else { if ($spf1c6fe) { echo '验证失败'; } } return false; } }