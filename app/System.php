<?php
namespace App; use Illuminate\Database\Eloquent\Model; class System extends Model { protected $guarded = array(); private static $systems = array(); public static function _init() { \Log::debug('SystemSetting._init'); static::$systems = \Cache::rememberForever('settings.all', function () { \Log::debug('SystemSetting._init.fetch from database'); $sp827d8a = System::query()->get()->toArray(); foreach ($sp827d8a as $spf82a70) { static::$systems[$spf82a70['name']] = $spf82a70['value']; } return static::$systems; }); static::$systems['_initialized'] = true; } public static function _get($spdbb9e7, $spd0e17e = NULL) { if (!isset(static::$systems['_initialized'])) { static::_init(); } if (isset(static::$systems[$spdbb9e7])) { return static::$systems[$spdbb9e7]; } return $spd0e17e; } public static function _getInt($spdbb9e7, $spd0e17e = NULL) { return (int) static::_get($spdbb9e7, $spd0e17e); } public static function _set($spdbb9e7, $spd77a65) { static::$systems[$spdbb9e7] = $spd77a65; $sp06d9c9 = System::query()->where('name', $spdbb9e7)->first(); if ($sp06d9c9) { $sp06d9c9->value = $spd77a65; $sp06d9c9->save(); } else { try { System::query()->insert(array('name' => $spdbb9e7, 'value' => $spd77a65)); } catch (\Exception $spa9e936) { } } self::flushCache(); } public static function flushCache() { \Log::debug('SystemSetting.flushCache'); \Cache::forget('settings.all'); } protected static function boot() { parent::boot(); static::updated(function () { self::flushCache(); }); static::created(function () { self::flushCache(); }); } }